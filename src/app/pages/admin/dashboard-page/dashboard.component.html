<div class="dashboard-container">
  <!-- First Login Banner (NEW) -->
  <div *ngIf="isFirstLogin && !showChangePasswordModal" class="first-login-banner">
    <div class="banner-content">
      <div class="banner-icon">üîê</div>
      <div class="banner-text">
        <h3>Selamat Datang!</h3>
        <p>Untuk keamanan akun Anda, harap segera mengubah password default Anda.</p>
      </div>
      <button class="banner-btn" (click)="showChangePasswordModal = true">
        Ubah Password Sekarang
      </button>
    </div>
  </div>

  <!-- Welcome Section -->
  <div class="welcome-section">
    <h1>DASHBOARD</h1>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Memuat data...</p>
  </div>

  <!-- Statistics Cards -->
  <div *ngIf="!loading" class="stats-grid">
    <div 
      *ngFor="let stat of stats" 
      class="stat-card"
      (click)="navigateTo(stat.route)"
      [class.clickable]="stat.route"
    >
      <div class="stat-content">
        <h3 class="stat-title">{{ stat.title }}</h3>
        <p class="stat-value">{{ stat.value }}</p>
        <div class="stat-trend" *ngIf="stat.trend">
          <span class="trend-value">+{{ stat.trend }}%</span>
          <span class="trend-label">dari bulan lalu</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Grid -->
  <div *ngIf="!loading" class="content-grid">
    <!-- Chart Section -->
    <div class="chart-card">
      <div class="card-header">
        <h2 class="card-title">Statistik Lead</h2>
      </div>

      <section class="charts">
        <app-monthly-lead-chart
          [data]="monthlyData">
        </app-monthly-lead-chart>

        <app-lead-trend-chart
          [data]="trendData">
        </app-lead-trend-chart>

        <app-conversion-chart
          [data]="conversionData">
        </app-conversion-chart>
      </section>
    </div>

    <!-- Recent Activities -->
    <div class="activity-card">
      <div class="card-header">
        <h2 class="card-title">Aktivitas terbaru</h2>
      </div>
      <div class="activity-list">
        <div
          *ngFor="let activity of recentActivities"
          class="activity-item"
          [ngClass]="getActivityClass(activity)"
        >
          <span class="activity-icon">
            {{ activity.icon }}
          </span>

          <div class="activity-content">
            <p
              class="activity-text"
              [innerHTML]="activity.text"
            ></p>
            <span class="activity-time">
              {{ activity.time }}
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div *ngIf="!loading" class="quick-actions">
    <h2 class="section-title">Quick Actions</h2>
    <div class="actions-grid">
      <button class="action-btn" (click)="navigateTo('/admin/lead-scoring')">
        <span class="action-label">Analisa Lead</span>
      </button>
      <button class="action-btn" (click)="navigateTo('/admin/request-layanan')">
        <span class="action-label">Verifikasi Request</span>
      </button>
      <button class="action-btn" (click)="navigateTo('/admin/klien')">
        <span class="action-label">Tambah Klien</span>
      </button>
      <button class="action-btn" (click)="navigateTo('/admin/rekap')">
        <span class="action-label">Buat Rekap</span>
      </button>
    </div>
  </div>
</div>

<!-- Change Password Modal (NEW) -->
<app-change-password
  *ngIf="showChangePasswordModal"
  [isFirstLogin]="isFirstLogin"
  (close)="onCloseModal()">
</app-change-password>