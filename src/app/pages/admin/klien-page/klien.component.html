<div class="klien-container">
  <!-- Header -->
  <div class="page-header">
    <div>
      <h1>KLIEN</h1>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card clickable" (click)="selectStatus(null)">
      <div class="stat-info">
        <span class="stat-label">Total Klien</span>
        <span class="stat-value">{{ statistics.total }}</span>
      </div>
    </div>

    <div class="stat-card clickable" (click)="selectStatus('BELUM')">
      <div class="stat-info">
        <span class="stat-label">Belum Aktif</span>
        <span class="stat-value">{{ statistics.belum }}</span>
      </div>
    </div>

    <div class="stat-card clickable" (click)="selectStatus('AKTIF')">
      <div class="stat-info">
        <span class="stat-label">Aktif</span>
        <span class="stat-value">{{ statistics.aktif }}</span>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="filter-section">
    <button 
      class="filter-btn"
      [class.active]="selectedStatus === null"
      (click)="selectStatus(null)"
    >
      Semua
    </button>
    <button 
      class="filter-btn"
      [class.active]="selectedStatus === 'BELUM'"
      (click)="selectStatus('BELUM')"
    >
      Belum Aktif
    </button>
    <button 
      class="filter-btn"
      [class.active]="selectedStatus === 'AKTIF'"
      (click)="selectStatus('AKTIF')"
    >
      Aktif
    </button>
  </div>

  <!-- Search Box -->
  <div class="search-section">
    <input 
      type="text" 
      placeholder="Cari klien"
      [(ngModel)]="searchKeyword"
      (ngModelChange)="onSearchChange()"
      class="search-input"
    />
    <button 
      class="btn-clear" 
      (click)="clearFilters()"
      *ngIf="searchKeyword || selectedStatus"
    >
      Clear Filters
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Memuat data...</p>
  </div>

  <!-- Table -->
  <div *ngIf="!loading" class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>Nama klien</th>
          <th>Email</th>
          <th>No. Telepon</th>
          <th>Status</th>
          <th>Tanggal request</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let klien of filteredKlien">
          <td>
            <strong>{{ klien.namaKlien }}</strong>
          </td>
          <td>{{ klien.emailKlien }}</td>
          <td>{{ klien.noTelp }}</td>
          <td>
            <div class="status-container">
              <span class="status-badge" [ngClass]="getStatusClass(klien.status)">
                {{ getStatusLabel(klien.status) }}
              </span>
              <small class="approved-info" *ngIf="klien.status === 'AKTIF' && klien.lastApprovedBy">
                <span class="icon-check">✓</span> oleh {{ klien.lastApprovedBy }}
              </small>
            </div>
          </td>
          <td>{{ formatDate(klien.tglRequest) }}</td>
          <td>
            <div class="action-buttons">
              <button
                *ngIf="canEdit"
                class="btn-icon" 
                (click)="openEditModal(klien)"
              >
                Edit
              </button>
              <button
                class="btn-icon btn-status" 
                (click)="toggleStatus(klien)"
              >
                {{ klien.status === 'AKTIF' ? 'Nonaktifkan' : 'Aktifkan' }}
              </button>
              <button
                *ngIf="canDelete" 
                class="btn-icon btn-delete" 
                (click)="deleteKlien(klien)"
              >
                Hapus
              </button>
            </div>
          </td>
        </tr>

        <tr *ngIf="filteredKlien.length === 0">
          <td colspan="6" class="empty-state">
            <div class="empty-illustration"></div>
            <p>Tidak ada klien yang sesuai filter</p>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal Overlay -->
<div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>{{ isEditMode ? 'Edit Klien' : 'Tambah Klien' }}</h2>
      <button class="close-btn" (click)="closeModal()">✕</button>
    </div>

    <div class="modal-body">
      <div class="form-group">
        <label>Nama Klien <span class="required">*</span></label>
        <input 
          type="text" 
          [(ngModel)]="formData.namaKlien"
          placeholder="Masukkan nama klien"
          class="form-input"
        />
      </div>

      <div class="form-group">
        <label>Email <span class="required">*</span></label>
        <input 
          type="email" 
          [(ngModel)]="formData.emailKlien"
          placeholder="Masukkan email"
          class="form-input"
        />
      </div>

      <div class="form-group">
        <label>No. Telepon <span class="required">*</span></label>
        <input 
          type="text" 
          [(ngModel)]="formData.noTelp"
          placeholder="Masukkan nomor telepon"
          class="form-input"
        />
      </div>

      <!-- Only show status when creating new klien, not editing -->
      <div class="form-group" *ngIf="!isEditMode">
        <label>Status <span class="required">*</span></label>
        <div class="custom-dropdown">
          <button 
            type="button"
            class="dropdown-trigger"
            (click)="toggleDropdown('status', $event)"
          >
            {{ getSelectedLabel('status') }}
            <span class="dropdown-arrow">▼</span>
          </button>
          <div class="dropdown-menu" *ngIf="dropdownStates['status']">
            <div 
              class="dropdown-item"
              (click)="selectDropdownItem('status', 'BELUM')"
            >
              Belum Aktif
            </div>
            <div 
              class="dropdown-item"
              (click)="selectDropdownItem('status', 'AKTIF')"
            >
              Aktif
            </div>
          </div>
        </div>
      </div>

      <!-- Info status for Edit Mode -->
      <div class="form-group" *ngIf="isEditMode">
        <label>Status Saat Ini</label>
        <div class="status-info">
          <span class="status-badge" [ngClass]="getStatusClass(formData.status)">
            {{ getStatusLabel(formData.status) }}
          </span>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeModal()">Batal</button>
      <button 
        class="btn-primary" 
        (click)="submitForm()"
        [disabled]="!isFormValid() || processing"
      >
        {{ processing ? 'Menyimpan...' : 'Simpan' }}
      </button>
    </div>
  </div>
</div>